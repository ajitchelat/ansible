<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <title>Speeding up execution - Citrix NetScaler Ansible Docs</title>
     
    <link rel="shortcut icon" href="
https://www.citrix.com/etc/designs/citrix/icon-favicon.png"> 
    <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
    <link rel="stylesheet" href="../../css/highlight.css">
    <link rel="stylesheet" href="../../css/override.css" type="text/css" />
    <link rel="stylesheet" href="../../css/font-awesome.css" type="text/css" /> 
    <script>
      // Current page data
      var mkdocs_page_name = "Speeding up execution";
      var mkdocs_page_input_path = "usage/speeding-up-execution.md";
      var mkdocs_page_url = "/usage/speeding-up-execution/";

    </script>
    
    <script src="../../js/jquery-2.1.1.min.js"></script>
    <script src="../../js/modernizr-2.8.3.min.js"></script>
    <script type="text/javascript" src="../../js/highlight.pack.js"></script>
    <script src="../../js/theme.js"></script>
    <script src="../../js/custom.js"></script>  
  </head>

  <body class="wy-body-for-nav" role="document">

    <div class="header-top">

        <div class="header-top-left">
          <a href="http://developer-docs.citrix.com" class="logo-position"><img height="60" src="../../img/citrixlogoblack.png" target="_blank" class="logo-citrix"><span style="color:#000;font-size: 20px;position: relative;top:4px;left:20px;">Developer Documentation</span></a>
        </div>
        <div class="header-top-right">
          <ul>

            <form id="rtd-search-form-alt" class="wy-form" action="../../search.html" method="get">
             <ul class="header-elements">
              <li class="list-inline support">
                <input name="q" id="txtName" type="text" placeholder="Search SDKs" class="searchdocs">
                <a class="fa fa-search errspan"></a>
<!---
              </li>
             <li> <a href="javascript:void(0);" style="font-size: 22px;position: relative;left: -10px;top: 3px"><i class="fa fa-globe"></i></a></li>
             </ul>
             --->
            </form>

          </ul>

        </div>

    </div>
    <div class="body">
      <div class="wy-grid-for-nav">

        
        <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
          <div class="wy-side-nav-search">
            <div role="search">
  <form id ="rtd-search-form-alt" class="wy-form" action="../../search.html" method="get">
	<i class="fa fa-search"></i>
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
          </div>

          <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            <ul class="current">
              
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../..">NetScaler Ansible Docs</a>
		
    </li>

			  
              
    <li><span style="font-size: 16px;padding-left: 0px;">User Documentation <i class="faexp fa fa-angle-down" aria-hidden="true"></i></span></li>
    <ul class="subnav" style="margin-left: 0px;padding-left:15px;border-left: 1px solid #b2b2b2;">
        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../getting-started/">Getting Started</a>
		
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="toctree-l1-a current" href="./">Speeding up execution</a>
		
            <ul style="margin-left: 0px;padding-left:15px;border-left: 1px solid #b2b2b2;">
            
                <li class="toctree-l3"><a href="#speeding-up-execution" style="padding:0px;position: relative;">&nbsp;Speeding up execution</a></li>
                
                    <li><a class="toctree-l4" href="#saving-configuration" style="padding:0px;position: relative;">Saving configuration</a></li>
                
                    <li><a class="toctree-l4" href="#sample-playbook" style="padding:0px;position: relative;">Sample playbook</a></li>
                
                    <li><a class="toctree-l4" href="#closing-remarks" style="padding:0px;position: relative;">Closing remarks</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../rolling-upgrades/">Rolling upgrades</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../rolling-upgrades-vpx/">Rolling upgrades (VPX)</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../docker-image/">Netscaler ansible docker image</a>
		
    </li>

        
    </ul>

			  
              
    <li><span style="font-size: 16px;padding-left: 0px;">Using Generic Ansible Modules <i class="faexp fa fa-angle-down" aria-hidden="true"></i></span></li>
    <ul class="subnav" style="margin-left: 0px;padding-left:15px;border-left: 1px solid #b2b2b2;">
        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../generic-modules/about/">Using generic Ansible modules</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../generic-modules/templating-configuration-file/">Templating the configuration file</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../generic-modules/nitro-api-calls/">Direct NITRO API calls</a>
		
    </li>

        
    </ul>

			  
              
    <li><span style="font-size: 16px;padding-left: 0px;">Module Documentation <i class="faexp fa fa-angle-down" aria-hidden="true"></i></span></li>
    <ul class="subnav" style="margin-left: 0px;padding-left:15px;border-left: 1px solid #b2b2b2;">
        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/">Module index</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-cs-action-module/">netscaler_cs_action</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-cs-policy-module/">netscaler_cs_policy</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-cs-vserver-module/">netscaler_cs_vserver</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-gslb-service-module/">netscaler_gslb_service</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-gslb-site-module/">netscaler_gslb_site</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-gslb-vserver-module/">netscaler_gslb_vserver</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-lb-monitor-module/">netscaler_lb_monitor</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-lb-vserver-module/">netscaler_lb_vserver</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-nitro-request-module/">netscaler_nitro_request</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-save-config-module/">netscaler_save_config</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-server-module/">netscaler_server</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-service-module/">netscaler_service</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-servicegroup-module/">netscaler_servicegroup</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-ssl-certkey-module/">netscaler_ssl_certkey</a>
		
    </li>

        
    </ul>

			  
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../development-utilities/">Developer Documentation</a>
		
    </li>

			  
            </ul>
          </div>
          &nbsp;
        </nav>

        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

           
          <div class="wy-nav-content">
            <div class="rst-content">
              <!-- <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>User Documentation &raquo;</li>
        
      
    
    <li>Speeding up execution</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div> -->
              <div role="main">
                <div class="section">
                <div class="file-format">
                 <div class="leftAlign" style="float: left;visibility: hidden;">
                  </div>
                  <div class="rightAlign" style="float: right;">
                      <span>Download full document:</span>
                      <ul class="file-types">
                        <li><a style="border: 1px solid #EE3D24;padding: 5px;font-size: 11px;color: #EE3D24;border-radius: 5px;font-weight: 700">PDF</a></li>
                        <li><a style="border: 1px solid #2A579A;padding: 5px;font-size: 11px;color: #2A579A;border-radius: 5px;font-weight: 700">DOCX</a></li>
                        <li><a style="border: 1px solid #495164;padding: 5px;font-size: 11px;color: #495164;border-radius: 5px;font-weight: 700">EMAIL</a></li>
                        <li><a style="border: 1px solid #495164;padding: 5px;font-size: 11px;color: #495164;border-radius: 5px;font-weight: 700">PRINT</a></li>
                      </ul>
                  </div>
                  </div>
                   <h1 id="speeding-up-execution"><a class="toclink" href="#speeding-up-execution">Speeding up execution</a></h1>
<p>This document details how to speed up the execution time of a playbook
containing invocations of Netscaler ansible modules.</p>
<p>Ansible has some options to help with speeding up execution by making
forks of itself to execute playbooks in multiple target hosts.</p>
<p>Also in the context of a single playbook the use of the <code>async</code> keyword
may help with parallelizing the execution of the tasks therein but at
the cost of increased complexity.</p>
<p>Both of the above methods can be used to speed up the execution of
playbooks containing invocations of Netscaler modules.</p>
<p>Here we will detail a third option which is specific to the Netscaler
modules and the way the underlying API is used.</p>
<h2 id="saving-configuration"><a class="toclink" href="#saving-configuration">Saving configuration</a></h2>
<p>By default every Netscaler module after it performs any changes to the configuration
of the Netscaler node will also save the configuration.</p>
<p>While this is the safest option as far as robustness is concerned, it turns out that the save configuration operation
is quite costly time wise, taking up to 5 seconds.</p>
<p>When multiple tasks within a playbook make changes to Netscaler entities these
delays accumulate to a substantial amount.</p>
<p>The solution is to instruct the Netscaler modules not to save the configuration
individually but instead notify a handler which will save the configuration once
at the end of the playbook execution.</p>
<p>To do this we need to use the <code>save_config</code> option along with the <code>netscaler_save_config</code>
module which will be invoked by the handler.</p>
<h2 id="sample-playbook"><a class="toclink" href="#sample-playbook">Sample playbook</a></h2>
<p>The following playbook demonstrates this technique.</p>
<div class="codehilite"><pre><span></span>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">netscaler</span>

          <span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">save_config</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
            <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>

          <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup server 1</span>

              <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
              <span class="l l-Scalar l-Scalar-Plain">notify</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Save netscaler configuration</span>

              <span class="l l-Scalar l-Scalar-Plain">netscaler_server</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">nsip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">172.18.0.2</span>
                <span class="l l-Scalar l-Scalar-Plain">nitro_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nsroot</span>
                <span class="l l-Scalar l-Scalar-Plain">nitro_pass</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nsroot</span>

                <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">}}&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">save_config</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">save_config</span><span class="nv"> </span><span class="s">}}&quot;</span>

                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">server-1</span>
                <span class="l l-Scalar l-Scalar-Plain">ipaddress</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.1.1</span>
                <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Our first server</span>

            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Set server 2</span>

              <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
              <span class="l l-Scalar l-Scalar-Plain">notify</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Save netscaler configuration</span>

              <span class="l l-Scalar l-Scalar-Plain">netscaler_server</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">nsip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">172.18.0.2</span>
                <span class="l l-Scalar l-Scalar-Plain">nitro_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nsroot</span>
                <span class="l l-Scalar l-Scalar-Plain">nitro_pass</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nsroot</span>

                <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">}}&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">save_config</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">save_config</span><span class="nv"> </span><span class="s">}}&quot;</span>

                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">server-2</span>
                <span class="l l-Scalar l-Scalar-Plain">ipaddress</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.1.2</span>
                <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Our second server</span>

          <span class="l l-Scalar l-Scalar-Plain">handlers</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Save netscaler configuration</span>
              <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
              <span class="l l-Scalar l-Scalar-Plain">netscaler_save_config</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">nsip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">172.18.0.2</span>
                <span class="l l-Scalar l-Scalar-Plain">nitro_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nsroot</span>
                <span class="l l-Scalar l-Scalar-Plain">nitro_pass</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nsroot</span>
</pre></div>


<h2 id="closing-remarks"><a class="toclink" href="#closing-remarks">Closing remarks</a></h2>
<p>As you see in the example we need to explicitly set the <code>save_config</code> option
since by default it is set to <code>yes</code>.</p>
<p>Also we call the <code>netscaler_save_config</code> module only once in the handlers section.</p>
<p>The number of times the configuration will be saved on the Netscaler module is
only one regardless of the number of changes, or none if there is no change recorded
in the result of any of the netscaler modules.</p>
<p>This is much better than the worst case with the default <code>save_config</code> option which would
save the configuration twice if both server modules made changes.</p>
<p>It is also just as fast as the best case with the default <code>save_config</code> option which would be
to save the configuration once in case only one of the tasks made any change.</p>
<p>Also note that the potential benefit increases, for each Netscaler module which utilizes the
save configuration handler. For example if we had ten Netscaler modules making changes we would
be saving the configuration ten times. Instead if these modules use the <code>netscaler_save_config</code>
as a handler we will have only one call to the save operation.</p> 

                </div>
              </div>

            </div>
          </div>

        </section>

      </div>
    </div>
    <!--<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span class="prev"><a href="../getting-started/"><i class="fa fa-angle-left"></i> Previous</a></span>
      
      
        <span class="next"><a href="../rolling-upgrades/">Next <i class="fa fa-angle-right"></i></a></span>
      
    </span>
	<div class="footer-right">
		<ul class="social-links">
			<li class="list-inline"><a href="https://twitter.com/citrix"><i class="fa fa-twitter"></i>@citrix</a></li>
			<li class="list-inline"><a href="mailto:support@citrix.com"><i class="fa fa-envelope-o"></i>support@citrix.com</a></li>
		</ul>
		<ul class="inner-pages">
			<li class="list-inline"><a href="http://citrix.com/about/legal">Privacy and Terms</li>
		</ul>
	</div>
</div>-->

  </body>

</html>
