
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Citrix NetScaler Ansible 0.1">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.1, mkdocs-material-1.4.1">
    
    
      
        <title>Direct NITRO API calls - Citrix NetScaler Ansible Docs</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-76741b64bc.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Citrix NetScaler Ansible Docs" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Using Generic Ansible Modules
                </span>
              
            
            Direct NITRO API calls
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Citrix NetScaler Ansible Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="NetScaler Ansible Docs" class="md-nav__link">
      NetScaler Ansible Docs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      User Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        User Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/speeding-up-execution/" title="Speeding up execution" class="md-nav__link">
      Speeding up execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/rolling-upgrades/" title="Rolling upgrades" class="md-nav__link">
      Rolling upgrades
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/rolling-upgrades-vpx/" title="Rolling upgrades (VPX)" class="md-nav__link">
      Rolling upgrades (VPX)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/docker-image/" title="Netscaler ansible docker image" class="md-nav__link">
      Netscaler ansible docker image
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Using Generic Ansible Modules
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Using Generic Ansible Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../about/" title="Using generic Ansible modules" class="md-nav__link">
      Using generic Ansible modules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../templating-configuration-file/" title="Templating the configuration file" class="md-nav__link">
      Templating the configuration file
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Direct NITRO API calls
      </label>
    
    <a href="./" title="Direct NITRO API calls" class="md-nav__link md-nav__link--active">
      Direct NITRO API calls
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#workflow" title="Workflow" class="md-nav__link">
    Workflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playbook" title="Playbook" class="md-nav__link">
    Playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Module Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Module Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/" title="Module index" class="md-nav__link">
      Module index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-cs-action-module/" title="netscaler_cs_action" class="md-nav__link">
      netscaler_cs_action
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-cs-policy-module/" title="netscaler_cs_policy" class="md-nav__link">
      netscaler_cs_policy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-cs-vserver-module/" title="netscaler_cs_vserver" class="md-nav__link">
      netscaler_cs_vserver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-gslb-service-module/" title="netscaler_gslb_service" class="md-nav__link">
      netscaler_gslb_service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-gslb-site-module/" title="netscaler_gslb_site" class="md-nav__link">
      netscaler_gslb_site
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-gslb-vserver-module/" title="netscaler_gslb_vserver" class="md-nav__link">
      netscaler_gslb_vserver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-lb-monitor-module/" title="netscaler_lb_monitor" class="md-nav__link">
      netscaler_lb_monitor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-lb-vserver-module/" title="netscaler_lb_vserver" class="md-nav__link">
      netscaler_lb_vserver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-save-config-module/" title="netscaler_save_config" class="md-nav__link">
      netscaler_save_config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-server-module/" title="netscaler_server" class="md-nav__link">
      netscaler_server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-service-module/" title="netscaler_service" class="md-nav__link">
      netscaler_service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-servicegroup-module/" title="netscaler_servicegroup" class="md-nav__link">
      netscaler_servicegroup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/netscaler-ssl-certkey-module/" title="netscaler_ssl_certkey" class="md-nav__link">
      netscaler_ssl_certkey
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../development-utilities/" title="Developer Documentation" class="md-nav__link">
      Developer Documentation
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#workflow" title="Workflow" class="md-nav__link">
    Workflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playbook" title="Playbook" class="md-nav__link">
    Playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="direct-nitro-api-calls"><a class="toclink" href="#direct-nitro-api-calls">Direct NITRO API calls</a></h1>
<p>One method of configuring Netscaler consists of making direct NITRO API
calls using Ansbile's <a href="http://docs.ansible.com/ansible/latest/uri_module.html">uri module</a>.</p>
<p>This method tends to be quite verbose since setting up even basic
functions requires multiple NITRO calls.</p>
<p>Another consideration is failure robustness. NITRO API call failures
result in the uri module task failing immediately and stopping the
execution of the rest of the playbook.</p>
<p>This may be desired behavior in general since in some cases we need to
examine the failure response to actually determine if the operation was
indeed a failure or expected.</p>
<p>An example of that would be trying to add a resource while it exists.
This is will result in failure since the HTTP POST request will not
create the resource but this does not mean the configuration of
Netscaler is necessarily invalid.</p>
<p>Using Ansible's conditional constructs we can work around this problem
in most cases but this adds to the verbosity and complexity of the
playbooks.</p>
<h2 id="workflow"><a class="toclink" href="#workflow">Workflow</a></h2>
<p>In the following example we use direct NITRO API calls to create or
update a basic server.</p>
<p>The play would be quite short but we have added some control logic to
detect whether the resource already exists and then apply the
appropriate operation.</p>
<p>We first try to get the details of the configuration resource. We
examine the outcome of this operation and if it was successful we
proceed to update the resource. If it failed we examine the exact
errorcode and if it signifies that the error was due to the resource
missing we proceed to create it.</p>
<p>On any other outcome, an error that was not what was expected, the play
fails.</p>
<p>The final task is to save the running configuration to ensure that a
reboot of Netscaler will not undo the changes we have made.</p>
<h2 id="playbook"><a class="toclink" href="#playbook">Playbook</a></h2>
<div class="codehilite"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">netscaler</span>
  <span class="l l-Scalar l-Scalar-Plain">gather_facts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
  <span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>
    <span class="l l-Scalar l-Scalar-Plain">request_payload</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">test-server-1</span>
        <span class="l l-Scalar l-Scalar-Plain">ipaddress</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.1.6</span>

  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Get resource</span>
      <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="l l-Scalar l-Scalar-Plain">ignore_errors</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="l l-Scalar l-Scalar-Plain">register</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
      <span class="l l-Scalar l-Scalar-Plain">uri</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://{{</span><span class="nv"> </span><span class="s">nsip</span><span class="nv"> </span><span class="s">}}/nitro/v1/config/{{</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">request_payload.server.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">method</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GET</span>
        <span class="l l-Scalar l-Scalar-Plain">status_code</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
        <span class="l l-Scalar l-Scalar-Plain">return_content</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class="l l-Scalar l-Scalar-Plain">headers</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">X-NITRO-USER</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
          <span class="l l-Scalar l-Scalar-Plain">X-NITRO-PASS</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_pass</span><span class="nv"> </span><span class="s">}}&quot;</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Check success or expected failure</span>
      <span class="l l-Scalar l-Scalar-Plain">assert</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">that</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result|succeeded or ( result|failed and result.json.errorcode == 258 )</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Add resource when not existing</span>
      <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="l l-Scalar l-Scalar-Plain">when</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result|failed</span>
      <span class="l l-Scalar l-Scalar-Plain">uri</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://{{</span><span class="nv"> </span><span class="s">nsip</span><span class="nv"> </span><span class="s">}}/nitro/v1/config/{{</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">method</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">POST</span>
        <span class="l l-Scalar l-Scalar-Plain">status_code</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">201</span>
        <span class="l l-Scalar l-Scalar-Plain">return_content</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class="l l-Scalar l-Scalar-Plain">headers</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">X-NITRO-USER</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
          <span class="l l-Scalar l-Scalar-Plain">X-NITRO-PASS</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_pass</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">body_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">json</span>
        <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">request_payload</span><span class="nv"> </span><span class="s">}}&quot;</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Update resource if existing</span>
      <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="l l-Scalar l-Scalar-Plain">when</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result|succeeded</span>
      <span class="l l-Scalar l-Scalar-Plain">uri</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://{{</span><span class="nv"> </span><span class="s">nsip</span><span class="nv"> </span><span class="s">}}/nitro/v1/config/{{</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">method</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">PUT</span>
        <span class="l l-Scalar l-Scalar-Plain">status_code</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
        <span class="l l-Scalar l-Scalar-Plain">return_content</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class="l l-Scalar l-Scalar-Plain">headers</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">X-NITRO-USER</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
          <span class="l l-Scalar l-Scalar-Plain">X-NITRO-PASS</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_pass</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">body_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">json</span>
        <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">request_payload</span><span class="nv"> </span><span class="s">}}&quot;</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Save running configuration</span>
      <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="l l-Scalar l-Scalar-Plain">uri</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://{{</span><span class="nv"> </span><span class="s">nsip</span><span class="nv"> </span><span class="s">}}/nitro/v1/config/nsconfig?action=save&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">method</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">POST</span>
        <span class="l l-Scalar l-Scalar-Plain">status_code</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
        <span class="l l-Scalar l-Scalar-Plain">headers</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">X-NITRO-USER</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
          <span class="l l-Scalar l-Scalar-Plain">X-NITRO-PASS</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_pass</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">body_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">json</span>
        <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">nsconfig</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
</pre></div>


<p>For the first task which detects if the resource already exists we have
set <code>ignore_errors: true</code>. This has the effect that an error will not
stop the execution of the playbook. We also register the result under
the variable <code>result</code> to be available for examination in the following
tasks.</p>
<p>The next task leverages Ansible's <a href="http://docs.ansible.com/ansible/latest/assert_module.html">assert module</a> to
distinguish between an expected failure and an unexpected one. In the
case of an unexpected failure this task fails and prevents any further
execution.</p>
<p>Next there are two tasks, one creating the resource and one updating the
existing resource. Which one executes depends on the condition defined
in each task's <code>when:</code> option.</p>
<h2 id="references"><a class="toclink" href="#references">References</a></h2>
<ul>
<li><a href="https://github.com/citrix/ansible-nitro-api-calls">Ansible NITRO API calls repository</a></li>
<li><a href="http://docs.ansible.com/ansible/latest/uri_module.html">Ansible uri module documentation</a></li>
<li><a href="http://docs.ansible.com/ansible/latest/assert_module.html">Ansible assert module documentation</a></li>
</ul>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../templating-configuration-file/" title="Templating the configuration file" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Templating the configuration file
              </span>
            </div>
          </a>
        
        
          <a href="../../modules/" title="Module index" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Module index
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-3964c0cb56.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>