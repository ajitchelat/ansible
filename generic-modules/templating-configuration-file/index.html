<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <title>Templating the configuration file - Citrix NetScaler Ansible Docs</title>
     
    <link rel="shortcut icon" href="
https://www.citrix.com/etc/designs/citrix/icon-favicon.png"> 
    <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
    <link rel="stylesheet" href="../../css/highlight.css">
    <link rel="stylesheet" href="../../css/override.css" type="text/css" />
    <link rel="stylesheet" href="../../css/font-awesome.css" type="text/css" /> 
    <script>
      // Current page data
      var mkdocs_page_name = "Templating the configuration file";
      var mkdocs_page_input_path = "generic-modules/templating-configuration-file.md";
      var mkdocs_page_url = "/generic-modules/templating-configuration-file/";

    </script>
    
    <script src="../../js/jquery-2.1.1.min.js"></script>
    <script src="../../js/modernizr-2.8.3.min.js"></script>
    <script type="text/javascript" src="../../js/highlight.pack.js"></script>
    <script src="../../js/theme.js"></script>
    <script src="../../js/custom.js"></script>  
  </head>

  <body class="wy-body-for-nav" role="document">

    <div class="header-top">

        <div class="header-top-left">
          <a href="http://developer-docs.citrix.com" class="logo-position"><img height="60" src="../../img/citrixlogoblack.png" target="_blank" class="logo-citrix"><span style="color:#000;font-size: 20px;position: relative;top:4px;left:20px;">Developer Documentation</span></a>
        </div>
        <div class="header-top-right">
          <ul>

            <form id="rtd-search-form-alt" class="wy-form" action="../../search.html" method="get">
             <ul class="header-elements">
              <li class="list-inline support">
                <input name="q" id="txtName" type="text" placeholder="Search SDKs" class="searchdocs">
                <a class="fa fa-search errspan"></a>
<!---
              </li>
             <li> <a href="javascript:void(0);" style="font-size: 22px;position: relative;left: -10px;top: 3px"><i class="fa fa-globe"></i></a></li>
             </ul>
             --->
            </form>

          </ul>

        </div>

    </div>
    <div class="body">
      <div class="wy-grid-for-nav">

        
        <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
          <div class="wy-side-nav-search">
            <div role="search">
  <form id ="rtd-search-form-alt" class="wy-form" action="../../search.html" method="get">
	<i class="fa fa-search"></i>
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
          </div>

          <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            <ul class="current">
              
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../..">NetScaler Ansible Docs</a>
		
    </li>

			  
              
    <li><span style="font-size: 16px;padding-left: 0px;">User Documentation <i class="faexp fa fa-angle-down" aria-hidden="true"></i></span></li>
    <ul class="subnav" style="margin-left: 0px;padding-left:15px;border-left: 1px solid #b2b2b2;">
        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../usage/getting-started/">Getting Started</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../usage/speeding-up-execution/">Speeding up execution</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../usage/rolling-upgrades/">Rolling upgrades</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../usage/rolling-upgrades-vpx/">Rolling upgrades (VPX)</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../usage/docker-image/">Netscaler ansible docker image</a>
		
    </li>

        
    </ul>

			  
              
    <li><span style="font-size: 16px;padding-left: 0px;">Using Generic Ansible Modules <i class="faexp fa fa-angle-down" aria-hidden="true"></i></span></li>
    <ul class="subnav" style="margin-left: 0px;padding-left:15px;border-left: 1px solid #b2b2b2;">
        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../about/">Using generic Ansible modules</a>
		
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="toctree-l1-a current" href="./">Templating the configuration file</a>
		
            <ul style="margin-left: 0px;padding-left:15px;border-left: 1px solid #b2b2b2;">
            
                <li class="toctree-l3"><a href="#templating-the-configuration-file" style="padding:0px;position: relative;">&nbsp;Templating the configuration file</a></li>
                
                    <li><a class="toctree-l4" href="#workflow" style="padding:0px;position: relative;">Workflow</a></li>
                
                    <li><a class="toctree-l4" href="#playbook" style="padding:0px;position: relative;">Playbook</a></li>
                
                    <li><a class="toctree-l4" href="#references" style="padding:0px;position: relative;">References</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../nitro-api-calls/">Direct NITRO API calls</a>
		
    </li>

        
    </ul>

			  
              
    <li><span style="font-size: 16px;padding-left: 0px;">Module Documentation <i class="faexp fa fa-angle-down" aria-hidden="true"></i></span></li>
    <ul class="subnav" style="margin-left: 0px;padding-left:15px;border-left: 1px solid #b2b2b2;">
        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/">Module index</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-cs-action-module/">netscaler_cs_action</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-cs-policy-module/">netscaler_cs_policy</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-cs-vserver-module/">netscaler_cs_vserver</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-gslb-service-module/">netscaler_gslb_service</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-gslb-site-module/">netscaler_gslb_site</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-gslb-vserver-module/">netscaler_gslb_vserver</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-lb-monitor-module/">netscaler_lb_monitor</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-lb-vserver-module/">netscaler_lb_vserver</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-nitro-request-module/">netscaler_nitro_request</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-save-config-module/">netscaler_save_config</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-server-module/">netscaler_server</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-service-module/">netscaler_service</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-servicegroup-module/">netscaler_servicegroup</a>
		
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../modules/netscaler-ssl-certkey-module/">netscaler_ssl_certkey</a>
		
    </li>

        
    </ul>

			  
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../../development-utilities/">Developer Documentation</a>
		
    </li>

			  
            </ul>
          </div>
          &nbsp;
        </nav>

        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

           
          <div class="wy-nav-content">
            <div class="rst-content">
              <!-- <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Using Generic Ansible Modules &raquo;</li>
        
      
    
    <li>Templating the configuration file</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div> -->
              <div role="main">
                <div class="section">
                <div class="file-format">
                 <div class="leftAlign" style="float: left;visibility: hidden;">
                  </div>
                  <div class="rightAlign" style="float: right;">
                      <span>Download full document:</span>
                      <ul class="file-types">
                        <li><a style="border: 1px solid #EE3D24;padding: 5px;font-size: 11px;color: #EE3D24;border-radius: 5px;font-weight: 700">PDF</a></li>
                        <li><a style="border: 1px solid #2A579A;padding: 5px;font-size: 11px;color: #2A579A;border-radius: 5px;font-weight: 700">DOCX</a></li>
                        <li><a style="border: 1px solid #495164;padding: 5px;font-size: 11px;color: #495164;border-radius: 5px;font-weight: 700">EMAIL</a></li>
                        <li><a style="border: 1px solid #495164;padding: 5px;font-size: 11px;color: #495164;border-radius: 5px;font-weight: 700">PRINT</a></li>
                      </ul>
                  </div>
                  </div>
                   <h1 id="templating-the-configuration-file"><a class="toclink" href="#templating-the-configuration-file">Templating the configuration file</a></h1>
<p>One method of configuring Netscaler consists of editing the ns.conf file
directly and then rebooting Netscaler for the configuration changes to
take effect.</p>
<p>After the reboot the saved configuration becomes the running
configuration which is what we want to change.</p>
<h2 id="workflow"><a class="toclink" href="#workflow">Workflow</a></h2>
<p>With this method we leverage Ansible's <a href="http://docs.ansible.com/ansible/latest/template_module.html">template module</a> to
produce a ns.conf file from a Jinja2 template.</p>
<p>The Jinja2 template is populated from configuration variables which can
be defined with various methods, inside the playbook, in an inventory
file or loaded from inventory files.</p>
<p>We then upload the resulting ns.conf to the Netscaler node which alters
the saved configuration.</p>
<p>For the saved configuration to become running configuration we need to
reboot Netscaler. Doing a warm reboot is recommended since it is
sufficient to reload the configuration and also avoid the greater
downtime a cold reboot would induce.</p>
<p>After the reboot the user can check the running configuration either
through the GUI or the command line interface and make sure the changes
have been succesfully applied.</p>
<p>There is an assortment of playbooks on this <a href="https://github.com/citrix/ansible-nitro-api-calls">github repository</a> which
contains sample playbooks that perform fundamental NITRO operations. The
tasks within each playbook can be combined into a larger playbook which
accomplishes a full Netscaler configuration.</p>
<p>In fact this is how the following example was constructed.</p>
<h2 id="playbook"><a class="toclink" href="#playbook">Playbook</a></h2>
<p>In the following example we showcase how we can setup a load balancer
which balances two backend services. The full content of the referenced
files can be found <a href="https://github.com/citrix/netscaler-rolling-updates-example">here</a>.</p>
<h3 id="processing-the-template"><a class="toclink" href="#processing-the-template">Processing the template</a></h3>
<p>First we have a Jinja template file to produce the desired ns.conf. It
is recommended to use an actual ns.conf file from the target Netscaler
node as a starting point for the template.</p>
<p>The full file is quite long but the interesting parts are shown below.</p>
<div class="codehilite"><pre><span></span><span class="nn">...</span>

<span class="c1"># Start of Jinja inserted servers</span>
<span class="p p-Indicator">{</span><span class="err">%</span> <span class="nv">for server in configuration.servers %</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">add server {{ server.name }} {{ server.ipaddress }}</span>
<span class="l l-Scalar l-Scalar-Plain">{% endfor %}</span>
<span class="l l-Scalar l-Scalar-Plain"># End of Jinja inserted servers</span>

<span class="nn">...</span>

<span class="c1"># Start of Jinja inserted services</span>
<span class="p p-Indicator">{</span><span class="err">%</span> <span class="nv">for service in configuration.services %</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">add service {{ service.name }} {{ service.ipaddress }} {{ service.type }} {{ service.port }} -gslb NONE -maxClient 0 -maxReq 0 -cip DISABLED -usip NO -useproxyport YES -sp OFF -cltTimeout 180 -svrTimeout 360 -CKA NO -TCPB NO -CMP NO</span>
<span class="l l-Scalar l-Scalar-Plain">{% endfor %}</span>
<span class="l l-Scalar l-Scalar-Plain"># End of Jinja inserted services</span>


<span class="nn">...</span>

<span class="c1"># Start of Jinja inserted lb vservers</span>
<span class="p p-Indicator">{</span><span class="err">%</span> <span class="nv">for vserver in configuration.lbvservers %</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">add lb vserver {{ vserver.name }} {{ vserver.type }} {{ vserver.ipaddress }} {{ vserver.port }} -persistenceType NONE -cltTimeout 180</span>
<span class="l l-Scalar l-Scalar-Plain">{% endfor %}</span>
<span class="l l-Scalar l-Scalar-Plain"># End of Jinja inserted lb vservers</span>

<span class="nn">...</span>

<span class="c1"># Start of Jinja inserted lb vservers binds</span>
<span class="p p-Indicator">{</span><span class="err">%</span> <span class="nv">for bind in configuration.lbvserver_binds %</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">bind lb vserver {{ bind.server }} {{ bind.service }} -weight {{ bind.weight }}</span>
<span class="l l-Scalar l-Scalar-Plain">{% endfor %}</span>
<span class="l l-Scalar l-Scalar-Plain"># End of Jinja inserted lb vservers binds</span>
</pre></div>


<p>Essentially we iterate over items in the configuration dictionary. This
dictionary is populated from the playbook variables.</p>
<h3 id="defining-the-configuration-variables"><a class="toclink" href="#defining-the-configuration-variables">Defining the configuration variables</a></h3>
<p>The playbook variables are shown below.</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">filename</span><span class="p p-Indicator">:</span> <span class="s">&quot;ns.conf&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">filelocation</span><span class="p p-Indicator">:</span> <span class="s">&quot;/nsconfig&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">localfile</span><span class="p p-Indicator">:</span> <span class="s">&quot;/var/tmp/ns.conf&quot;</span>

  <span class="l l-Scalar l-Scalar-Plain">warm_reboot</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>

  <span class="l l-Scalar l-Scalar-Plain">configuration</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">servers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.1.1</span>
        <span class="l l-Scalar l-Scalar-Plain">ipaddress</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.1.1</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.1.2</span>
        <span class="l l-Scalar l-Scalar-Plain">ipaddress</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.1.2</span>

    <span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">service-test-1</span>
        <span class="l l-Scalar l-Scalar-Plain">ipaddress</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.1.1</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">HTTP</span>

      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">service-test-2</span>
        <span class="l l-Scalar l-Scalar-Plain">ipaddress</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.1.2</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">HTTP</span>

    <span class="l l-Scalar l-Scalar-Plain">lbvservers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">server-test</span>
        <span class="l l-Scalar l-Scalar-Plain">ipaddress</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.78.60.203</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">HTTP</span>

    <span class="l l-Scalar l-Scalar-Plain">lbvserver_binds</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">server-test</span>
        <span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">service-test-1</span>
        <span class="l l-Scalar l-Scalar-Plain">weight</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">50</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">server-test</span>
        <span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">service-test-2</span>
        <span class="l l-Scalar l-Scalar-Plain">weight</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">50</span>
</pre></div>


<p>The configuration dictionary is defined inside the playbook. This is
done for maintaining simplicity in the context of the example.</p>
<p>A more sophisticated setup could have defined the configuration
dictionary in a separate variables file, in the inventory file or use
any other method Ansible allows to define variables.</p>
<p>We also see the variables that configure the paths of the source and
target files. These could also be defined in the different ways the
configuration dictionary is defined.</p>
<h3 id="upload-the-new-nsconf"><a class="toclink" href="#upload-the-new-nsconf">Upload the new ns.conf</a></h3>
<p>Having produced the ns.conf file we need to upload it to Netscaler.</p>
<p>Following are the tasks that accomplish this.</p>
<div class="codehilite"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Delete old ns.conf</span>
  <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class="l l-Scalar l-Scalar-Plain">uri</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://{{</span><span class="nv"> </span><span class="s">nsip</span><span class="nv"> </span><span class="s">}}/nitro/v1/config/systemfile?args=filename:{{</span><span class="nv"> </span><span class="s">filename</span><span class="nv"> </span><span class="s">}},filelocation:{{</span><span class="nv"> </span><span class="s">filelocation</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">replace(&#39;/&#39;,&#39;%2F&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">method</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">DELETE</span>
    <span class="l l-Scalar l-Scalar-Plain">status_code</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
    <span class="l l-Scalar l-Scalar-Plain">return_content</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="l l-Scalar l-Scalar-Plain">headers</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">X-NITRO-USER</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">X-NITRO-PASS</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_pass</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Upload new ns.conf</span>
  <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class="l l-Scalar l-Scalar-Plain">uri</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://{{</span><span class="nv"> </span><span class="s">nsip</span><span class="nv"> </span><span class="s">}}/nitro/v1/config/systemfile&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">method</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">POST</span>
    <span class="l l-Scalar l-Scalar-Plain">status_code</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">201</span>
    <span class="l l-Scalar l-Scalar-Plain">return_content</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="l l-Scalar l-Scalar-Plain">headers</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">X-NITRO-USER</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">X-NITRO-PASS</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_pass</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">body_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">json</span>
    <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">systemfile</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">filename</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">filename</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">filecontent</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;file&#39;,</span><span class="nv"> </span><span class="s">localfile)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">b64encode</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">filelocation</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">filelocation</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>


<p>Notice that we need to delete the existing file before copying the new
one. Trying to upload a file to an existing file path will result in a
NITRO error.</p>
<h3 id="rebooting-netscaler"><a class="toclink" href="#rebooting-netscaler">Rebooting Netscaler</a></h3>
<p>The last step is to warm reboot the Netscaler node. Replacing the
ns.conf file overwrites the saved configuration. The running
configuration of Netscaler remains unaffected. To force Netscaler to
apply the saved configuration we need to reboot it. We have the option
do a warm reboot which results in less downtime than a full reboot.</p>
<p>The task that accomplishes this is shown below.</p>
<div class="codehilite"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Reboot Netscaler</span>
  <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class="l l-Scalar l-Scalar-Plain">uri</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://{{</span><span class="nv"> </span><span class="s">nsip</span><span class="nv"> </span><span class="s">}}/nitro/v1/config/reboot&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">method</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">POST</span>
    <span class="l l-Scalar l-Scalar-Plain">status_code</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">201</span>
    <span class="l l-Scalar l-Scalar-Plain">headers</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">X-NITRO-USER</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">X-NITRO-PASS</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nitro_pass</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">body_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">json</span>
    <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">reboot</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">warm</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">warm_reboot</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>


<h3 id="final-points"><a class="toclink" href="#final-points">Final points</a></h3>
<p>The user needs for this example to set the variables needed for
authentication and communication with Netscaler. Namely <code>nsip</code>,
<code>nitro_user</code>, <code>nitro_pass</code>. These variables retain the meaning they have
in the Netscaler specific Ansible modules.</p>
<p>All tasks are run with the <code>delegate_to: localhost</code> option set. This is
needed since we are making NITRO API calls to the Netscaler node. We do
not want to connect directly with SSH to it.</p>
<p>In some deployments the delegated host may need to be the bastion node
that has actual NITRO access to the Netscaler node.</p>
<h2 id="references"><a class="toclink" href="#references">References</a></h2>
<ul>
<li><a href="https://github.com/citrix/ansible-nitro-api-calls">Ansible NITRO API calls repository</a></li>
<li><a href="http://docs.ansible.com/ansible/latest/template_module.html">Ansible template module documentation</a></li>
</ul> 

                </div>
              </div>

            </div>
          </div>

        </section>

      </div>
    </div>
    <!--<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span class="prev"><a href="../about/"><i class="fa fa-angle-left"></i> Previous</a></span>
      
      
        <span class="next"><a href="../nitro-api-calls/">Next <i class="fa fa-angle-right"></i></a></span>
      
    </span>
	<div class="footer-right">
		<ul class="social-links">
			<li class="list-inline"><a href="https://twitter.com/citrix"><i class="fa fa-twitter"></i>@citrix</a></li>
			<li class="list-inline"><a href="mailto:support@citrix.com"><i class="fa fa-envelope-o"></i>support@citrix.com</a></li>
		</ul>
		<ul class="inner-pages">
			<li class="list-inline"><a href="http://citrix.com/about/legal">Privacy and Terms</li>
		</ul>
	</div>
</div>-->

  </body>

</html>
